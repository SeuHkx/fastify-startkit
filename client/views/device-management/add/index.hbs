{{!-- 新增设备页面 --}}
<style>
    /* 表单样式优化 */
    .form-row {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
        min-height: 2.5rem;
    }

    .form-label {
        width: 120px;
        text-align: right;
        margin-right: 4px;
        font-weight: normal;
        white-space: nowrap;
        flex-shrink: 0;
    }

    .form-label .required {
        color: #ff3860;
    }

    .form-control {
        flex: 1;
        max-width: 300px;
    }

    .form-control .input,
    .form-control .select {
        width: 100%;
    }

    .form-control .select select {
        width: 100%;
    }

    .help {
        margin-left: 8px;
    }

    /* 按钮区域 */
    .button-group {
        display: flex;
        justify-content: flex-start;
        gap: 0.5rem;
    }

    .page-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 10px;
        color: #363636;
    }

    /* 点位配置表格样式 */
    .points-section {
        margin-top: 2rem;
    }

    .points-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .points-controls {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .points-title {
        font-size: 16px;
        font-weight: 600;
        color: #363636;
    }

    .add-point-btn {
        background-color: #3273dc;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.875rem;
    }

    .add-point-btn:hover {
        background-color: #2366d1;
    }

    /* 点位配置表格容器 - 添加滚动条 */
    .tabs-box {
        max-height: calc(100vh - 530px);
        overflow-y: auto;
        overflow-x: hidden;
        border: none;
        border-radius: 6px;
        background-color: white;
    }

    /* 表格按钮区域固定在顶部 */
    .points-controls-in-tab {
        position: sticky;
        top: 0;
        background-color: white;
        z-index: 10;
        padding: 10px;
        border-bottom: 1px solid #dbdbdb;
        margin: -1px -1px 0 -1px; /* 抵消容器的边框和内边距 */
    }

    .points-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 0; /* 移除底部边距 */
    }

    .points-table th,
    .points-table td {
        padding: 0.75rem;
        text-align: left;
        border-bottom: 1px solid #dbdbdb;
        vertical-align: middle;
    }

    .points-table th {
        background-color: #f5f5f5;
        font-weight: 600;
        color: #363636;
    }

    .points-table .input,
    .points-table .select {
        width: 100%;
        min-width: 100px;
    }

    .points-table .select select {
        width: 100%;
    }

    .delete-point-btn {
        color: #ff3860;
        background: none;
        border: none;
        cursor: pointer;
        text-decoration: underline;
        font-size: 0.875rem;
    }

    .delete-point-btn:hover {
        color: #ff1443;
    }

    /* 禁用状态样式 */
    .points-table input:disabled,
    .points-table select:disabled {
        background-color: #f5f5f5;
        color: #7a7a7a;
        cursor: not-allowed;
    }

    .points-table button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .points-table .select:has(select:disabled) {
        opacity: 0.7;
    }

    /* 成功提示样式 */
    .notification.is-success {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        min-width: 300px;
    }

    /* Tabs样式 */
    .tabs.is-boxed li a {
        cursor: pointer;
        transition: background-color 0.2s ease;
    }

    .tabs.is-boxed li a:hover {
        background-color: #f5f5f5;
    }

    .tabs {
        margin-bottom: 10px !important;
    }

    /* 空状态样式 */
    .empty-state {
        border: 2px dashed #dbdbdb;
        border-radius: 6px;
        margin-top: 1rem;
    }

    .empty-state .has-text-grey {
        font-size: 0.9rem;
    }

    /* Tab标签样式优化 */
    .tabs.is-boxed li a {
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .tabs.is-boxed li a .tag {
        background-color: #f5f5f5;
        color: #4a4a4a;
    }

    .tabs.is-boxed li.is-active a .tag {
        background-color: rgba(255, 255, 255, 0.2);
        color: inherit;
    }
</style>

<div class="main-content-box--container" x-data="deviceAdd">
    <div class="device-add-container">
        <!-- 页面标题 -->
        <div class="page-title">添加设备</div>

        <!-- 添加表单 -->
        <div class="">
            <form @submit.prevent="submitForm">
                <!-- 设备类型 -->
                <div class="form-row">
                    <label class="form-label">
                        <span class="required">*</span>设备类型：
                    </label>
                    <div class="form-control">
                        <div class="select" :class="{ 'is-danger': errors.type }">
                            <select x-model="form.type" @change="validateField('type'); onDeviceTypeChange()">
                                <option value="">请选择</option>
                                <template x-for="deviceType in deviceTypes" :key="deviceType.id">
                                    <option :value="deviceType.id" x-text="deviceType.name"></option>
                                </template>
                            </select>
                        </div>
                    </div>
                    <p x-show="errors.type" class="help is-danger" x-text="errors.type"></p>
                </div>

                <!-- 设备类型名称 -->
                <div class="form-row">
                    <label class="form-label">
                        <span class="required">*</span>设备名称：
                    </label>
                    <div class="form-control">
                        <input class="input" :class="{ 'is-danger': errors.name }" type="text" placeholder="请输入"
                            x-model="form.name" @blur="validateField('name')" @input="clearError('name')">
                    </div>
                    <p x-show="errors.name" class="help is-danger" x-text="errors.name"></p>
                </div>


                <!-- 控制地址 -->
                <div class="form-row">
                    <label class="form-label">
                        <span class="required">*</span>控制地址：
                    </label>
                    <div class="form-control">
                        <input class="input" :class="{ 'is-danger': errors.conaddr }" type="text"
                            placeholder="请输入" x-model="form.conaddr" @blur="validateField('conaddr')"
                            @input="clearError('conaddr')">
                    </div>
                    <p x-show="errors.conaddr" class="help is-danger" x-text="errors.conaddr"></p>
                </div>

                <!-- 反馈地址 -->
                <div class="form-row">
                    <label class="form-label">
                        <span class="required">*</span>反馈地址：
                    </label>
                    <div class="form-control">
                        <input class="input" :class="{ 'is-danger': errors.retadd }" type="text"
                            placeholder="请输入" x-model="form.retadd" @blur="validateField('retadd')"
                            @input="clearError('retadd')">
                    </div>
                    <p x-show="errors.retadd" class="help is-danger" x-text="errors.retadd"></p>
                </div>

                <div class="form-row">
                    <label class="form-label"></label>
                    <div class="form-control">
                        <!-- 操作按钮 -->
                        <div class="button-group">
                            <button class="button" type="button" @click="cancel" :disabled="isSubmitting">
                                取消
                            </button>
                            <button class="button is-link" type="submit" :class="{ 'is-loading': isSubmitting }"
                                :disabled="!isFormValid || isSubmitting">
                                保存
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 点位配置部分 -->
                <div class="points-section">
                    <div class="points-header">
                        <div class="points-title">点位配置</div>
                    </div>
                    
                    <!-- Tab导航 - 始终显示 -->
                    <div class="tabs is-boxed">
                        <ul>
                            <li :class="{ 'is-active': activeTab === 'DI' }">
                                <a @click="switchTab('DI')">
                                    DI
                                    <span class="tag is-small is-rounded ml-1" x-show="pointsDI.length > 0" x-text="pointsDI.length"></span>
                                </a>
                            </li>
                            <li :class="{ 'is-active': activeTab === 'DO' }">
                                <a @click="switchTab('DO')">
                                    DO
                                    <span class="tag is-small is-rounded ml-1" x-show="pointsDO.length > 0" x-text="pointsDO.length"></span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- 点位配置表格 - 始终显示 -->
                    {{> components/data/device-points-table-di}}
                    {{> components/data/device-points-table-do}}
            
                </div>


            </form>
        </div>
    </div>

    <!-- 成功提示 -->
    <div class="notification is-success" x-show="showSuccess" x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0 transform scale-90" x-transition:enter-end="opacity-100 transform scale-100"
        x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100 transform scale-100"
        x-transition:leave-end="opacity-0 transform scale-90">
        <button class="delete" @click="showSuccess = false"></button>
        设备添加成功！
    </div>
</div>