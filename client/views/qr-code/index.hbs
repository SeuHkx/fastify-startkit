<section class="main-content-box--container" x-data="qrCode">
  <div class="qrcode-container">
    <!-- å·¦ä¾§ï¼šé…ç½®è¡¨å• -->
    <div class="qrcode-form">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h2 class="title is-5">å¾®ä¿¡å°ç¨‹åºäºŒç»´ç ç”Ÿæˆ</h2>
        <button class="button is-small" @click="toggleBatchMode" x-text="batchMode ? 'åˆ‡æ¢åˆ°å•ä¸ªæ¨¡å¼' : 'åˆ‡æ¢åˆ°æ‰¹é‡æ¨¡å¼'"></button>
      </div>
      
      <!-- é”™è¯¯æç¤º -->
      <div x-show="error" class="notification is-danger" style="margin-bottom: 1rem;">
        <button class="delete" @click="clearError"></button>
        <span x-text="error"></span>
      </div>
      
      <!-- å•ä¸ªç”Ÿæˆæ¨¡å¼ -->
      <div x-show="!batchMode">
        <div class="box">
          <h3 class="title is-6">äºŒç»´ç å‚æ•°</h3>
          <div class="field">
            <label class="label">Scene (åœºæ™¯å€¼) <span class="has-text-danger">*</span></label>
            <div class="control">
              <input class="input" type="text" x-model="form.scene" placeholder="æœ€å¤š32ä¸ªå­—ç¬¦ï¼Œå¦‚ï¼š001" maxlength="32">
            </div>
            <p class="help">ç”¨äºåŒºåˆ†ä¸åŒåœºæ™¯çš„å‚æ•°ï¼Œæœ€å¤§32ä¸ªå­—ç¬¦</p>
          </div>
          
          <div class="field">
            <label class="label">Page (é¡µé¢è·¯å¾„)</label>
            <div class="control">
              <input class="input" type="text" x-model="form.page" placeholder="å¦‚ï¼špages/index/index">
            </div>
            <p class="help">å°ç¨‹åºé¡µé¢è·¯å¾„ï¼Œä¸å¡«åˆ™é»˜è®¤è·³è½¬é¦–é¡µ</p>
          </div>
          
          <div class="field">
            <label class="label">Width (å®½åº¦)</label>
            <div class="control">
              <input class="input" type="number" x-model="form.width" min="280" max="1280" placeholder="430">
            </div>
            <p class="help">äºŒç»´ç å®½åº¦ï¼Œé»˜è®¤430ï¼Œæœ€å°280ï¼Œæœ€å¤§1280</p>
          </div>
        </div>
        
        <!-- ç”ŸæˆæŒ‰é’® -->
        <div class="field">
          <div class="control">
            <button 
              class="button is-primary is-fullwidth" 
              @click="generateQRCode"
              :class="{ 'is-loading': loading }"
              :disabled="loading">
              <span class="icon">
                <i class="fa fa-qrcode"></i>
              </span>
              <span>ç”ŸæˆäºŒç»´ç </span>
            </button>
          </div>
        </div>
      </div>
      
      <!-- æ‰¹é‡ç”Ÿæˆæ¨¡å¼ -->
      <div x-show="batchMode">
        <div class="box">
          <h3 class="title is-6">æ‰¹é‡äºŒç»´ç å‚æ•°</h3>
          
          <div class="field">
            <label class="label">Page (å…¬å…±é¡µé¢è·¯å¾„)</label>
            <div class="control">
              <input class="input" type="text" x-model="form.page" placeholder="å¦‚ï¼špages/index/index">
            </div>
            <p class="help">æ‰€æœ‰äºŒç»´ç çš„å…¬å…±é¡µé¢è·¯å¾„ï¼ˆå¯é€‰ï¼‰</p>
          </div>
          
          <div class="field">
            <label class="label">Width (å…¬å…±å®½åº¦)</label>
            <div class="control">
              <input class="input" type="number" x-model="form.width" min="280" max="1280" placeholder="430">
            </div>
            <p class="help">æ‰€æœ‰äºŒç»´ç çš„å®½åº¦ï¼Œé»˜è®¤430</p>
          </div>
        </div>
        
        <!-- æ‰¹é‡æ¨¡å¼é€‰æ‹© -->
        <div class="box">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3 class="title is-6" style="margin-bottom: 0;">ç”Ÿæˆæ–¹å¼</h3>
            <button class="button is-small is-info" @click="toggleRegionMode" x-text="useRegionMode ? 'åˆ‡æ¢åˆ°è‡ªç”±è¾“å…¥' : 'åˆ‡æ¢åˆ°åŒºåŸŸåºåˆ—'"></button>
          </div>
          
          <!-- åŒºåŸŸåºåˆ—æ¨¡å¼ -->
          <div x-show="useRegionMode">
            <div class="field">
              <label class="label">é€‰æ‹©åŒºåŸŸ <span class="has-text-danger">*</span></label>
              <div class="control">
                <div class="select is-fullwidth">
                  <select x-model="regionCode">
                    <template x-for="region in regions" :key="region.code">
                      <option :value="region.code" x-text="`${region.name} (${region.code})`"></option>
                    </template>
                  </select>
                </div>
              </div>
              <p class="help">é€‰æ‹©è¦ç”ŸæˆäºŒç»´ç çš„åŒºåŸŸ</p>
            </div>
            
            <div class="field">
              <label class="label">ç”Ÿæˆæ•°é‡ <span class="has-text-danger">*</span></label>
              <div class="control">
                <input class="input" type="number" x-model.number="batchCount" min="1" max="500" placeholder="100">
              </div>
              <p class="help">æ‰¹é‡ç”Ÿæˆçš„äºŒç»´ç æ•°é‡ï¼ˆæœ€å¤š500ä¸ªï¼‰</p>
            </div>
            
            <div class="field">
              <label class="label">èµ·å§‹åºå·</label>
              <div class="control">
                <input class="input" type="number" x-model.number="startNumber" min="1" placeholder="1">
              </div>
              <p class="help">åºå·èµ·å§‹å€¼ï¼Œé»˜è®¤ä»1å¼€å§‹</p>
            </div>
            
            <!-- é¢„è§ˆç¤ºä¾‹ -->
            <div class="notification is-info is-light" style="margin-top: 1rem;">
              <p class="has-text-weight-bold">ç”Ÿæˆç¤ºä¾‹ï¼š</p>
              <p x-show="regionCode && batchCount > 0">
                <span x-text="`${regionCode}${String(startNumber).padStart(7, '0')}`"></span>
                <span x-show="batchCount > 1"> ~ </span>
                <span x-show="batchCount > 1" x-text="`${regionCode}${String(startNumber + batchCount - 1).padStart(7, '0')}`"></span>
              </p>
              <p class="help" style="margin-top: 0.5rem;">
                æ ¼å¼ï¼šåŒºåŸŸä»£ç (6ä½) + åºå·(7ä½)ï¼Œå…±13ä½å­—ç¬¦
              </p>
            </div>
          </div>
          
          <!-- è‡ªç”±è¾“å…¥æ¨¡å¼ -->
          <div x-show="!useRegionMode">
            <div class="field">
              <label class="label">Scene åˆ—è¡¨ <span class="has-text-danger">*</span></label>
              <div class="control">
                <textarea 
                  class="textarea" 
                  x-model="batchText" 
                  placeholder="æ¯è¡Œä¸€ä¸ªåœºæ™¯å€¼ï¼Œä¾‹å¦‚ï¼š&#10;001&#10;002&#10;003&#10;&#10;æˆ–æŒ‡å®šè‡ªå®šä¹‰æ–‡ä»¶åï¼š&#10;001|user-001.png&#10;002|user-002.png"
                  rows="10"></textarea>
              </div>
              <p class="help">æ¯è¡Œä¸€ä¸ªåœºæ™¯å€¼ï¼Œæ”¯æŒæ ¼å¼ï¼šscene æˆ– scene|filename.png</p>
            </div>
          </div>
        </div>
        
        <!-- æ‰¹é‡ç”ŸæˆæŒ‰é’® -->
        <div class="field">
          <div class="control">
            <button 
              class="button is-primary is-fullwidth" 
              @click="batchGenerateQRCode"
              :class="{ 'is-loading': batchLoading }"
              :disabled="batchLoading">
              <span class="icon">
                <i class="fa fa-download"></i>
              </span>
              <span>æ‰¹é‡ç”Ÿæˆå¹¶ä¸‹è½½ ZIP</span>
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- å³ä¾§ï¼šäºŒç»´ç é¢„è§ˆï¼ˆä»…åœ¨å•ä¸ªæ¨¡å¼æ˜¾ç¤ºï¼‰ -->
    <div class="qrcode-preview" x-show="!batchMode">
      <h2 class="title is-5">äºŒç»´ç é¢„è§ˆ</h2>
      <div class="qrcode-display">
        <template x-if="!qrCodeUrl && !loading">
          <div class="qrcode-placeholder">
            <span class="icon is-large has-text-grey-light">
              <i class="fa fa-qrcode fa-5x"></i>
            </span>
            <p class="has-text-grey">è¯·é…ç½®å‚æ•°å¹¶ç”ŸæˆäºŒç»´ç </p>
          </div>
        </template>
        
        <template x-if="loading">
          <div class="qrcode-placeholder">
            <div class="loader"></div>
            <p class="has-text-grey">æ­£åœ¨ç”ŸæˆäºŒç»´ç ...</p>
          </div>
        </template>
        
        <template x-if="qrCodeUrl && !loading">
          <div class="qrcode-image">
            <img :src="qrCodeUrl" alt="Generated QR Code" />
            <div class="qrcode-actions">
              <button class="button is-success" @click="downloadQRCode">
                <span>ä¸‹è½½äºŒç»´ç </span>
              </button>
            </div>
          </div>
        </template>
      </div>
    </div>
    
    <!-- å³ä¾§ï¼šæ‰¹é‡æ¨¡å¼è¯´æ˜ -->
    <div class="qrcode-preview" x-show="batchMode">
      <h2 class="title is-5">æ‰¹é‡ç”Ÿæˆè¯´æ˜</h2>
      <div class="batch-info-box">
        <div class="content">
          <h4>ä¸¤ç§ç”Ÿæˆæ–¹å¼</h4>
          
          <div class="notification is-primary is-light">
            <p class="has-text-weight-bold">ğŸ¯ åŒºåŸŸåºåˆ—æ¨¡å¼ï¼ˆæ¨èï¼‰</p>
            <p>é€‚ç”¨äºéœ€è¦æŒ‰åŒºåŸŸç¼–ç æ‰¹é‡ç”Ÿæˆè¿ç»­åºå·çš„åœºæ™¯</p>
            <ul style="margin-top: 0.5rem;">
              <li>é€‰æ‹©åŒºåŸŸï¼ˆå¦‚ï¼šæˆéƒ½é«˜æ–°åŒº - 510102ï¼‰</li>
              <li>è®¾ç½®ç”Ÿæˆæ•°é‡ï¼ˆå¦‚ï¼š100ï¼‰</li>
              <li>è‡ªåŠ¨ç”Ÿæˆåºåˆ—ï¼š5101020000001 ~ 5101020000100</li>
            </ul>
          </div>
          
          <div class="notification is-info is-light" style="margin-top: 1rem;">
            <p class="has-text-weight-bold">ğŸ“ è‡ªç”±è¾“å…¥æ¨¡å¼</p>
            <p>é€‚ç”¨äºè‡ªå®šä¹‰åœºæ™¯å€¼çš„æ‰¹é‡ç”Ÿæˆ</p>
            <ul style="margin-top: 0.5rem;">
              <li>æ¯è¡Œè¾“å…¥ä¸€ä¸ªåœºæ™¯å€¼</li>
              <li>æ”¯æŒæ ¼å¼ï¼š<code>scene</code> æˆ– <code>scene|filename.png</code></li>
            </ul>
          </div>
          
          <h4>åŒºåŸŸåºåˆ—è§„åˆ™</h4>
          <ul>
            <li><strong>æ ¼å¼ï¼š</strong>åŒºåŸŸä»£ç (6ä½) + åºå·(7ä½) = 13ä½å­—ç¬¦</li>
            <li><strong>ç¤ºä¾‹ï¼š</strong>510102 + 0000001 = 5101020000001</li>
            <li><strong>èŒƒå›´ï¼š</strong>å¯ç”Ÿæˆ 1 åˆ° 9,999,999 çš„åºå·</li>
            <li><strong>é™åˆ¶ï¼š</strong>å•æ¬¡æœ€å¤šç”Ÿæˆ 500 ä¸ªäºŒç»´ç </li>
          </ul>
          
          <h4>è‡ªç”±è¾“å…¥ç¤ºä¾‹</h4>
          <pre class="example-text">001
002
003
user-123|custom-name.png</pre>
          
          <h4>ä¸‹è½½å†…å®¹</h4>
          <p>ZIP æ–‡ä»¶ä¸­åŒ…å«ï¼š</p>
          <ul>
            <li>æ‰€æœ‰æˆåŠŸç”Ÿæˆçš„äºŒç»´ç å›¾ç‰‡ï¼ˆPNG æ ¼å¼ï¼‰</li>
            <li><code>summary.json</code> - ç”Ÿæˆç»“æœæ±‡æ€»æ–‡ä»¶</li>
          </ul>
          
          <h4>æ³¨æ„äº‹é¡¹</h4>
          <ul>
            <li>æ‰¹é‡ç”Ÿæˆä¼šä¾æ¬¡è¯·æ±‚å¾®ä¿¡æ¥å£ï¼Œæ•°é‡è¾ƒå¤šæ—¶éœ€è¦è€å¿ƒç­‰å¾…</li>
            <li>å¾®ä¿¡æœ‰æ¥å£è°ƒç”¨é¢‘ç‡é™åˆ¶ï¼Œå»ºè®®å•æ¬¡ä¸è¶…è¿‡ 500 ä¸ª</li>
            <li>ç”Ÿæˆå¤±è´¥çš„äºŒç»´ç ä¼šåœ¨ summary.json ä¸­æ ‡æ³¨</li>
            <li>åŒºåŸŸåºåˆ—æ¨¡å¼ä¸‹ï¼Œæ–‡ä»¶åè‡ªåŠ¨ä¸ºåœºæ™¯å€¼.png</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .qrcode-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    padding: 10;
    margin: 0 auto;
  }
  
  @media (max-width: 1024px) {
    .qrcode-container {
      grid-template-columns: 1fr;
    }
  }
  
  .qrcode-form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  
  .qrcode-preview {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  
  .qrcode-display {
    background: #f5f5f5;
    border: 2px dashed #dbdbdb;
    border-radius: 6px;
    padding: 2rem;
    min-height: 500px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .qrcode-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 1rem;
  }
  
  .qrcode-image {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
  }
  
  .qrcode-image img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
  }
  
  .qrcode-actions {
    display: flex;
    gap: 1rem;
  }
  
  /* Loading spinner */
  .loader {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #3273dc;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .box {
    background: white;
    border-radius: 6px;
    box-shadow: 0 0.5em 1em -0.125em rgba(10,10,10,0.1);
    padding: 1.25rem;
  }
  
  .field:not(:last-child) {
    margin-bottom: 0.75rem;
  }
  
  .label {
    color: #363636;
    display: block;
    font-size: 14px;
    font-weight: 700;
    margin-bottom: 0.5rem;
  }
  
  .help {
    display: block;
    font-size: 0.75rem;
    margin-top: 0.25rem;
    color: #7a7a7a;
  }
  
  .notification {
    background-color: whitesmoke;
    border-radius: 4px;
    padding: 1.25rem 2.5rem 1.25rem 1.5rem;
    position: relative;
  }
  
  .notification.is-danger {
    background-color: #f14668;
    color: #fff;
  }
  
  .notification .delete {
    position: absolute;
    right: 0.5rem;
    top: 0.5rem;
  }
  
  .delete {
    background-color: rgba(10,10,10,0.2);
    border: none;
    border-radius: 290486px;
    cursor: pointer;
    display: inline-block;
    height: 20px;
    width: 20px;
    position: relative;
  }
  
  .delete::before,
  .delete::after {
    background-color: white;
    content: "";
    display: block;
    left: 50%;
    position: absolute;
    top: 50%;
    transform: translateX(-50%) translateY(-50%) rotate(45deg);
    transform-origin: center center;
  }
  
  .delete::before {
    height: 2px;
    width: 50%;
  }
  
  .delete::after {
    height: 50%;
    width: 2px;
  }
  
  /* æ‰¹é‡æ¨¡å¼æ ·å¼ */
  .batch-info-box {
    background: white;
    border-radius: 6px;
    padding: 1.5rem;
    box-shadow: 0 0.5em 1em -0.125em rgba(10,10,10,0.1);
  }
  
  .batch-info-box .content h4 {
    color: #363636;
    font-size: 1rem;
    font-weight: 700;
    margin-bottom: 0.75rem;
    margin-top: 1rem;
  }
  
  .batch-info-box .content h4:first-child {
    margin-top: 0;
  }
  
  .batch-info-box .content ul,
  .batch-info-box .content ol {
    margin-left: 1.5rem;
    margin-top: 0.5rem;
  }
  
  .batch-info-box .content li {
    margin-bottom: 0.5rem;
  }
  
  .batch-info-box .content code {
    background-color: #f5f5f5;
    color: #da1039;
    font-size: 0.875em;
    font-weight: normal;
    padding: 0.25em 0.5em;
    border-radius: 3px;
  }
  
  .example-text {
    background-color: #f5f5f5;
    border: 1px solid #dbdbdb;
    border-radius: 4px;
    color: #4a4a4a;
    display: block;
    font-size: 0.875em;
    overflow-x: auto;
    padding: 1rem;
    white-space: pre;
    margin-top: 0.5rem;
  }
  
  .textarea {
    display: block;
    width: 100%;
    min-width: 100%;
    max-width: 100%;
    padding: 0.625em;
    border: 1px solid #dbdbdb;
    border-radius: 4px;
    font-family: monospace;
    font-size: 0.875rem;
    line-height: 1.5;
    resize: vertical;
  }
  
  .textarea:focus {
    border-color: #3273dc;
    outline: none;
    box-shadow: 0 0 0 0.125em rgba(50, 115, 220, 0.25);
  }
  
  /* Select ä¸‹æ‹‰æ¡†æ ·å¼ */
  .select {
    display: inline-block;
    max-width: 100%;
    position: relative;
    vertical-align: top;
  }
  
  .select.is-fullwidth {
    width: 100%;
  }
  
  .select.is-fullwidth select {
    width: 100%;
  }
  
  .select select {
    cursor: pointer;
    display: block;
    font-size: 1rem;
    max-width: 100%;
    outline: none;
    border: 1px solid #dbdbdb;
    border-radius: 4px;
    background-color: white;
    color: #363636;
  }
  
  .select select:hover {
    border-color: #b5b5b5;
  }
  
  .select select:focus {
    border-color: #3273dc;
    box-shadow: 0 0 0 0.125em rgba(50, 115, 220, 0.25);
  }
  
  .select:not(.is-multiple):not(.is-loading)::after {
    border: 3px solid #3273dc;
    border-radius: 2px;
    border-right: 0;
    border-top: 0;
    content: " ";
    display: block;
    height: 0.625em;
    margin-top: -0.4375em;
    pointer-events: none;
    position: absolute;
    top: 50%;
    transform: rotate(-45deg);
    transform-origin: center;
    width: 0.625em;
    right: 1.125em;
    z-index: 4;
  }
  
  /* ä¿¡æ¯æ¡†æ ·å¼ */
  .notification.is-light {
    background-color: whitesmoke;
  }
  
  .notification.is-primary.is-light {
    background-color: #ebfffc;
    color: #00947e;
  }
  
  .notification.is-info.is-light {
    background-color: #eff5fb;
    color: #296fa8;
  }
</style>